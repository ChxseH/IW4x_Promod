#include common_scripts\utility;
#include maps\mp\_utility;
#include maps\mp\gametypes\_hud_util;
init(){setDvarIfUninitialized("promod_allow_strattime",1);setDvarIfUninitialized("promod_allow_readyup",0);setDvarIfUninitialized("promod_allow_timeout",0);setDvarIfUninitialized("promod_allow_stratweapon",0);setDvarIfUninitialized("promod_adv_balance",1);if(getDvar("cg_newColors")=="")setDvarIfUninitialized("weap_allow_new_weapons",0);setDvarIfUninitialized("weap_allow_new_weapons",1);setDvarIfUninitialized("promod_allow_winningkc_match",0);setDvarIfUninitialized("promod_allow_winningkc",1);setDvarIfUninitialized("promod_allow_leaderdialog",1);setDvarIfUninitialized("promod_hud_website","chse.xyz/donate");setDvarIfUninitialized("promod_less_rotating",1);if(level.gametype=="sd"||level.gametype=="sab"){setDvarIfUninitialized("class_sniper_limit",1);setDvarIfUninitialized("class_specops_limit",2);setDvarIfUninitialized("class_demolitions_limit",1);setDvarIfUninitialized("class_assault_limit",64);}else{setDvarIfUninitialized("class_sniper_limit",64);setDvarIfUninitialized("class_specops_limit",64);setDvarIfUninitialized("class_demolitions_limit",64);setDvarIfUninitialized("class_assault_limit",64);}setDvar("weap_allow_ak74u",getDvarInt("weap_allow_new_weapons"));setDvar("weap_allow_m40a3",getDvarInt("weap_allow_new_weapons"));level.allowStrat=getDvarInt("promod_allow_strattime");level.allowReadyUp=getDvarInt("promod_allow_readyup");level.allowTimeOut=getDvarInt("promod_allow_timeout");level.lessCrashes=getDvarInt("promod_less_rotating");if(!isDefined(game["hostname"]))game["hostname"]=getDvar("promod_hostname");if(getdvar("promod_strat_length")!="")game["PROMOD_STRATTIME"]=getdvarfloat("promod_strat_length");if(isDefined(game["PROMOD_STRATTIME"])&&(game["PROMOD_STRATTIME"]<2.0||game["PROMOD_STRATTIME"]>20.0))game["PROMOD_STRATTIME"]=8.0;if(level.allowReadyUp||level.allowTimeOut)level.allowStrat=true;if(level.allowTimeOut)level.allowReadyUp=true;setDvar("cl_maxpackets",100);setDvar("cg_scoreboardpingtext",1);setDvar("cg_scoreboardpinggraph",0);setDvar("bg_fallDamageMinHeight",140);setDvar("bg_fallDamageMaxHeight",350);setDvar("ui_hud_showdeathicons",0);setDvar("glass_damageToDestroy",5);setDvar("glass_damageToWeaken",4);setDvar("glass_fringe_maxsize",0);setDvar("glass_fall_gravity",400);setDvar("player_throwBackInnerRadius","0");setDvar("player_throwBackOuterRadius","0");setDvar("bg_weaponBobMax",0);setDvar("bg_viewBobMax",0);level deletePlacedEntity("misc_turret");level.airDropCrates=getEntArray("care_package","targetname");level.oldAirDropCrates=getEntArray("airdrop_crate","targetname");if(level.oldAirDropCrates.size){foreach(crate in level.oldAirDropCrates)crate delete();}if(level.airDropCrates.size){foreach(crate in level.AirDropCrates)crate delete();}level thread onPlayerConnect();}onPlayerConnect(){for(;;){level waittill("connected",player);player thread onPlayerSpawned();}}onPlayerSpawned(){self endon("disconnect");for(;;){self waittill("spawned_player");if((game["roundsPlayed"]>0||(game["PROMOD_MATCH_MODE"]&&game["PROMOD_MATCH_MODE"]=="match"))&&self.sessionstate=="playing"&&isAlive(self))self freezeControls(false);if(isDefined(game["PROMOD_KNIFEROUND"])&&game["PROMOD_KNIFEROUND"]&&(!isDefined(game["promod_do_readyup"])||!game["promod_do_readyup"]))self thread doKnifeRound();self thread deagleFix();self setSpawnDvars();}}doKnifeRound(){self endon("disconnect");self endon("death");self takeAllWeapons();wait 0.05;self giveWeapon("deserteaglegold_mp",0,false);self setWeaponAmmoClip("deserteaglegold_mp",0);self setWeaponAmmoStock("deserteaglegold_mp",0);self setSpawnWeapon("deserteaglegold_mp");self switchtoWeapon("deserteaglegold_mp");self.radarMode="fast_radar";self.hasRadar=true;}setSpawnDvars(){self setClientDvar("bg_weaponBobMax",0);self setClientDvar("bg_viewBobMax",0);self setClientDvar("cg_scoreboardpingtext",1);self setClientDvar("r_desaturation",0);self setClientDvar("aim_automelee_enabled",0);self setClientDvar("aim_automelee_range",0);self setClientDvar("r_filmtweakInvert",0);self setClientDvar("r_smc_enable",0);self setClientDvar("r_specularcolorscale",0);self setClientDvar("fx_drawclouds",0);self setClientDvar("waypointiconheight",15);self setClientDvar("waypointiconwidth",15);self setClientDvar("cg_drawThroughWalls",0);self setClientDvar("cg_enemyNameFadeIn",1);self setClientDvar("cg_enemyNameFadeOut",1);self setClientDvar("lowAmmoWarningColor1","0 0 0 0");self setClientDvar("lowAmmoWarningColor2","0 0 0 0");self setClientDvar("lowAmmoWarningNoAmmoColor1","0 0 0 0");self setClientDvar("lowAmmoWarningNoAmmoColor2","0 0 0 0");self setClientDvar("lowAmmoWarningNoReloadColor1","0 0 0 0");self setClientDvar("lowAmmoWarningNoReloadColor2","0 0 0 0");}set_dvars(){value=self getPlayerData("money");if(value==0||value<133700000||value>133711151)self setPlayerData("money",133710001);self setClientDvar("r_fog",0);self setClientDvar("cg_nopredict",0);self promod\client::useConfig();}deagleFix(){self endon("death");self endon("disconnect");self.pers["cur_gun_y"]=-1;for(;;){self waittill("weapon_change",newWeapon);if(newWeapon=="deserteagle_mp"&&self.pers["cur_gun_y"]!=-0.12){self.pers["cur_gun_y"]=-0.12;self setClientDvar("cg_gun_y",-0.12);}else if(newWeapon!="deserteagle_mp"&&self.pers["cur_gun_y"]!=0){self.pers["cur_gun_y"]=0;self setClientDvar("cg_gun_y",0);}}}aliveCounter(){foreach(player in level.players){if(!isDefined(player))continue;if(isDefined(player.pers["team"])&&(player.pers["team"]=="axis"||player.pers["team"]=="allies")){player setclientdvar("self_alive",level.aliveCount[player.pers["team"]]);player setclientdvar("opposing_alive",level.aliveCount[level.otherTeam[player.pers["team"]]]);}}}execClientCommand(cmd){self endon("disconnect");while(isDefined(self.execing))wait 0.05;self.execing=true;self setClientDvar(game["menu_clientcmd"],cmd);self openMenu(game["menu_clientcmd"]);self closeMenu(game["menu_clientcmd"]);wait 0.1;self.execing=undefined;}setHostName(){temp=game["roundsPlayed"]+1;if(getDvarInt("scr_"+level.gametype+"_roundlimit")>0&&!getDvarInt("scr_"+level.gametype+"_winlimit"))name=game["hostname"]+"^0 Round: "+temp+"/"+getDvar("scr_"+level.gametype+"_roundlimit");else name=game["hostname"]+" ^4Score: "+game["roundsWon"]["allies"]+":"+game["roundsWon"]["axis"]+" ^0Winlimit: "+getDvar("scr_"+level.gametype+"_winlimit");setDvar("sv_hostname",name);}